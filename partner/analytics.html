<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partner Analytics - BAYK Partnership</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js for analytics visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="../index.html" class="navbar-brand">
                <svg width="24" height="24" viewBox="0 0 100 100" class="bayk-logo-small">
                    <rect x="10" y="10" width="80" height="80" fill="none" stroke="currentColor" stroke-width="3"/>
                    <path d="M15 75 Q50 65 85 75 L85 85 L15 85 Z" fill="#0047AB"/>
                    <path d="M50 15 L50 70 L35 70 Z" fill="#FF8C00"/>
                    <path d="M35 70 Q50 75 65 70 L65 75 L35 75 Z" fill="currentColor"/>
                </svg>
                B.A.Y.K. Partnership
            </a>
            <ul class="navbar-nav">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="scanner.html">QR Scanner</a></li>
                <li><a href="analytics.html" class="active">Analytics</a></li>
                <li><a href="#" onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container" style="padding: 2rem 0;">
        <!-- Page Header -->
        <section class="card">
            <h1>Business Analytics</h1>
            <p style="color: var(--text-light); font-size: 1.1rem;">
                Track your performance and ROI from the sailing club partnership program
            </p>
        </section>

        <!-- Key Metrics -->
        <section class="grid grid-4" style="margin: 2rem 0;">
            <div class="metric-card">
                <div class="metric-value" id="total-transactions">45</div>
                <div class="metric-label">Total Transactions</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="total-revenue">$2,100</div>
                <div class="metric-label">Revenue Generated</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="total-discounts">$340</div>
                <div class="metric-label">Discounts Provided</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="net-revenue">$1,760</div>
                <div class="metric-label">Net Revenue</div>
            </div>
        </section>

        <!-- Performance Charts -->
        <section class="grid grid-2" style="margin: 2rem 0;">
            <div class="card">
                <div class="card-header">
                    <h3>Monthly Transaction Volume</h3>
                </div>
                <div style="position: relative; height: 300px;">
                    <canvas id="transactionChart"></canvas>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3>Revenue vs Discounts</h3>
                </div>
                <div style="position: relative; height: 300px;">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Offer Performance -->
        <section class="card">
            <div class="card-header">
                <h3>Offer Performance</h3>
            </div>
            <div class="grid grid-2">
                <div class="offer-performance">
                    <h4>15% off all meals</h4>
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                        <span>Transactions:</span>
                        <span><strong>32</strong></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                        <span>Revenue:</span>
                        <span><strong>$1,440</strong></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                        <span>Discounts:</span>
                        <span style="color: var(--accent-red);"><strong>$216</strong></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0; font-weight: 600; border-top: 1px solid #e5e7eb; padding-top: 0.5rem;">
                        <span>Net Revenue:</span>
                        <span style="color: var(--secondary-green);"><strong>$1,224</strong></span>
                    </div>
                </div>
                <div class="offer-performance">
                    <h4>Happy Hour Special</h4>
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                        <span>Transactions:</span>
                        <span><strong>13</strong></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                        <span>Revenue:</span>
                        <span><strong>$260</strong></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                        <span>Discounts:</span>
                        <span style="color: var(--accent-red);"><strong>$130</strong></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 0.5rem 0; font-weight: 600; border-top: 1px solid #e5e7eb; padding-top: 0.5rem;">
                        <span>Net Revenue:</span>
                        <span style="color: var(--secondary-green);"><strong>$130</strong></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Peak Hours Analysis -->
        <section class="card">
            <div class="card-header">
                <h3>Peak Usage Times</h3>
            </div>
            <div style="position: relative; height: 250px;">
                <canvas id="peakHoursChart"></canvas>
            </div>
        </section>

        <!-- Customer Insights -->
        <section class="grid grid-2" style="margin: 2rem 0;">
            <div class="card">
                <div class="card-header">
                    <h3>Top Customers</h3>
                </div>
                <div id="top-customers">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                        <div>
                            <div style="font-weight: 600;">Zafer Gunel</div>
                            <div style="color: var(--text-light); font-size: 0.9rem;">5 transactions</div>
                        </div>
                        <div style="color: var(--secondary-green); font-weight: 600;">$225</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid #e5e7eb;">
                        <div>
                            <div style="font-weight: 600;">Serdar Bilecen</div>
                            <div style="color: var(--text-light); font-size: 0.9rem;">3 transactions</div>
                        </div>
                        <div style="color: var(--secondary-green); font-weight: 600;">$180</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem;">
                        <div>
                            <div style="font-weight: 600;">Ozalp Harut</div>
                            <div style="color: var(--text-light); font-size: 0.9rem;">2 transactions</div>
                        </div>
                        <div style="color: var(--secondary-green); font-weight: 600;">$120</div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h3>ROI Analysis</h3>
                </div>
                <div style="text-align: center; padding: 2rem 0;">
                    <div style="font-size: 3rem; font-weight: 700; color: var(--secondary-green); margin-bottom: 1rem;">517%</div>
                    <div style="color: var(--text-light); margin-bottom: 2rem;">Return on Investment</div>
                    <div style="background-color: #f3f4f6; padding: 1rem; border-radius: 0.5rem; text-align: left;">
                        <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                            <span>Revenue Generated:</span>
                            <span><strong>$2,100</strong></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 0.5rem 0;">
                            <span>Discounts Provided:</span>
                            <span><strong>$340</strong></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 0.5rem 0; font-weight: 600; border-top: 1px solid #d1d5db; padding-top: 0.5rem;">
                            <span>Net Profit:</span>
                            <span style="color: var(--secondary-green);"><strong>$1,760</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Growth Trends -->
        <section class="card">
            <div class="card-header">
                <h3>Growth Trends</h3>
            </div>
            <div class="grid grid-3">
                <div class="metric-card">
                    <div class="metric-value" style="color: var(--secondary-green);">+23%</div>
                    <div class="metric-label">Month-over-Month Growth</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" style="color: var(--secondary-green);">+45%</div>
                    <div class="metric-label">Customer Acquisition</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" style="color: var(--secondary-green);">+18%</div>
                    <div class="metric-label">Average Transaction Value</div>
                </div>
            </div>
        </section>

        <!-- Recommendations -->
        <section class="card">
            <div class="card-header">
                <h3>Business Recommendations</h3>
            </div>
            <div class="recommendations">
                <div style="display: flex; align-items: start; margin-bottom: 1rem; padding: 1rem; background-color: #f0fdf4; border-radius: 0.5rem; border-left: 4px solid var(--secondary-green);">
                    <div style="margin-right: 1rem; font-size: 1.5rem;">💡</div>
                    <div>
                        <h4 style="margin-bottom: 0.5rem;">Expand Happy Hour</h4>
                        <p style="color: var(--text-light); margin: 0;">Your happy hour special has high engagement. Consider extending the hours or adding more appetizer options.</p>
                    </div>
                </div>
                <div style="display: flex; align-items: start; margin-bottom: 1rem; padding: 1rem; background-color: #eff6ff; border-radius: 0.5rem; border-left: 4px solid var(--primary-blue);">
                    <div style="margin-right: 1rem; font-size: 1.5rem;">📈</div>
                    <div>
                        <h4 style="margin-bottom: 0.5rem;">Peak Time Optimization</h4>
                        <p style="color: var(--text-light); margin: 0;">Most transactions occur between 6-8 PM. Consider staffing adjustments during these peak hours.</p>
                    </div>
                </div>
                <div style="display: flex; align-items: start; padding: 1rem; background-color: #fef3c7; border-radius: 0.5rem; border-left: 4px solid #f59e0b;">
                    <div style="margin-right: 1rem; font-size: 1.5rem;">🎯</div>
                    <div>
                        <h4 style="margin-bottom: 0.5rem;">Lunch Promotion</h4>
                        <p style="color: var(--text-light); margin: 0;">Lunch transactions are lower. Consider creating a lunch-specific offer to increase midday traffic.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer style="background-color: var(--primary-blue); color: var(--white); padding: 2rem 0; margin-top: 4rem;">
        <div class="container text-center">
            <p>&copy; 2025 Sailing Club Partnership Platform. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Logout functionality
        function logout() {
            localStorage.removeItem('selectedRole');
            window.location.href = '../index.html';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in as partner
            const currentRole = localStorage.getItem('selectedRole');
            if (currentRole !== 'partner') {
                window.location.href = '../index.html';
                return;
            }

            loadPartnerData();
            createCharts();
        });

        async function loadPartnerData() {
            try {
                const response = await fetch('../assets/data/users.json');
                const data = await response.json();
                
                // Find Sunger Pizza (demo partner)
                const partner = data.partners.find(p => p.id === 'p001');
                if (partner) {
                    // Update metrics
                    document.getElementById('total-transactions').textContent = partner.total_transactions;
                    document.getElementById('total-revenue').textContent = `$${partner.revenue_impact}`;
                    document.getElementById('total-discounts').textContent = `$${partner.discounts_provided}`;
                    document.getElementById('net-revenue').textContent = `$${partner.revenue_impact - partner.discounts_provided}`;
                }
            } catch (error) {
                console.error('Error loading partner data:', error);
            }
        }

        function createCharts() {
            createTransactionChart();
            createRevenueChart();
            createPeakHoursChart();
        }

        function createTransactionChart() {
            const ctx = document.getElementById('transactionChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
                    datasets: [{
                        label: 'Transactions',
                        data: [12, 15, 18, 22, 28, 32, 35, 38, 45],
                        borderColor: '#1e40af',
                        backgroundColor: 'rgba(30, 64, 175, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
                    datasets: [{
                        label: 'Revenue',
                        data: [480, 600, 720, 880, 1120, 1280, 1400, 1520, 2100],
                        backgroundColor: '#059669',
                        borderColor: '#047857',
                        borderWidth: 1
                    }, {
                        label: 'Discounts',
                        data: [72, 90, 108, 132, 168, 192, 210, 228, 340],
                        backgroundColor: '#dc2626',
                        borderColor: '#b91c1c',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createPeakHoursChart() {
            const ctx = document.getElementById('peakHoursChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['11AM', '12PM', '1PM', '2PM', '3PM', '4PM', '5PM', '6PM', '7PM', '8PM', '9PM'],
                    datasets: [{
                        label: 'Transactions',
                        data: [2, 8, 5, 3, 1, 2, 4, 12, 15, 8, 3],
                        backgroundColor: '#1e40af',
                        borderColor: '#1e3a8a',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
